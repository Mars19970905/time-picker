<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…±åŒæœ‰ç©ºæ™‚é–“æ¯”è¼ƒå™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .input-section {
            border: 2px solid #e0e0e0;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #fafafa;
        }

        .filled-people {
            background-color: #e8f5e8;
            border: 2px solid #4CAF50;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .date-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .month-separator {
            grid-column: 1 / -1;
            text-align: center;
            font-weight: bold;
            color: #2196F3;
            background-color: #e3f2fd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid #2196F3;
        }

        .date-option {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .date-option:hover {
            border-color: #4CAF50;
            background-color: #f8fff8;
        }

        .date-option.selected {
            border-color: #4CAF50;
            background-color: #e8f5e8;
        }

        .date-option.weekend {
            background-color: #fff3e0;
            border-color: #ff9800;
        }

        .date-option.weekend:hover {
            border-color: #f57c00;
            background-color: #ffe0b2;
        }

        .date-option.weekend.selected {
            border-color: #f57c00;
            background-color: #ffcc80;
        }

        .date-option input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .weekday-label {
            font-size: 12px;
            color: #666;
            margin-left: 5px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }

        button:hover {
            background-color: #45a049;
        }

        .clear-btn {
            background-color: #f44336;
        }

        .clear-btn:hover {
            background-color: #da190b;
        }

        .edit-btn {
            background-color: #2196F3;
        }

        .edit-btn:hover {
            background-color: #1976D2;
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            background-color: #e8f5e8;
            border-radius: 8px;
            border-left: 5px solid #4CAF50;
        }

        .no-result {
            background-color: #ffe8e8;
            border-left-color: #f44336;
        }

        .people-list {
            margin-bottom: 20px;
        }

        .person-card {
            background-color: #f0f8ff;
            border: 1px solid #87ceeb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .person-name {
            font-weight: bold;
            color: #2c5282;
            margin-bottom: 8px;
        }

        .date-tag {
            display: inline-block;
            background-color: #2196F3;
            color: white;
            padding: 5px 10px;
            margin: 2px;
            border-radius: 15px;
            font-size: 14px;
        }

        .common-date {
            background-color: #4CAF50;
            font-weight: bold;
        }

        .status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }

        .edit-mode {
            background-color: #fff3e0;
            border: 2px solid #ff9800;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ—“ï¸ å…±åŒæœ‰ç©ºæ™‚é–“æ¯”è¼ƒå™¨</h1>

        <!-- å¡«å¯«å€åŸŸ -->
        <div class="input-section">
            <h2>ğŸ“ å¡«å¯«æ‚¨çš„æœ‰ç©ºæ™‚é–“</h2>
            <div class="form-group">
                <label>å§“å:</label>
                <input type="text" id="person-name" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
            </div>
            <div class="form-group">
                <label>é¸æ“‡æ‚¨æœ‰ç©ºçš„æ—¥æœŸ (10æœˆ-11æœˆ): <span class="weekday-label">ğŸŸ  é€±æœ« ğŸ“… å¹³æ—¥</span></label>
                <div class="date-grid" id="date-grid"></div>
            </div>
            <button onclick="submitPerson()">âœ… æäº¤æˆ‘çš„æœ‰ç©ºæ™‚é–“</button>
            <button class="clear-btn" onclick="clearMyInput()">ğŸ”„ é‡æ–°å¡«å¯«</button>
        </div>

        <!-- å·²å¡«å¯«äººå“¡åˆ—è¡¨ -->
        <div class="people-list">
            <h2>ğŸ‘¥ å·²å¡«å¯«äººå“¡ (<span id="people-count">0</span>äºº)</h2>
            <div id="filled-people"></div>
        </div>

        <!-- æ§åˆ¶æŒ‰éˆ• -->
        <div style="text-align: center;">
            <button onclick="compareCommonDates()">ğŸ” æ‰‹å‹•é‡æ–°è¨ˆç®—</button>
            <button class="clear-btn" onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨è³‡æ–™</button>
        </div>

        <!-- çµæœé¡¯ç¤º -->
        <div id="result"></div>
    </div>

    <script>
        let filledPeople = [];

        // å¾ localStorage è¼‰å…¥è³‡æ–™
        function loadDataFromStorage() {
            const savedData = localStorage.getItem('filledPeople');
            if (savedData) {
                try {
                    filledPeople = JSON.parse(savedData);
                } catch (error) {
                    console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', error);
                    filledPeople = [];
                }
            }
        }

        // å°‡è³‡æ–™ä¿å­˜åˆ° localStorage
        function saveDataToStorage() {
            try {
                localStorage.setItem('filledPeople', JSON.stringify(filledPeople));
            } catch (error) {
                console.error('ä¿å­˜è³‡æ–™å¤±æ•—:', error);
            }
        }

        // ç”Ÿæˆ10æœˆå’Œ11æœˆçš„æ‰€æœ‰æ—¥æœŸ
        function generateOctoberAndNovemberDates() {
            const year = new Date().getFullYear();
            const allDates = [];

            // 10æœˆæœ‰31å¤©
            for (let day = 1; day <= 31; day++) {
                const date = new Date(year, 9, day); // 9ä»£è¡¨10æœˆ (0-based)
                const dayOfWeek = date.getDay();
                const dateStr = date.toISOString().split('T')[0];

                // é€±åå°æ‡‰
                const weekdays = ['é€±æ—¥', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­'];
                const weekdayName = weekdays[dayOfWeek];

                // åˆ¤æ–·æ˜¯å¦ç‚ºé€±æœ«
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;

                allDates.push({
                    date: dateStr,
                    display: `${year}/10/${day.toString().padStart(2, '0')} (${weekdayName})`,
                    isWeekend: isWeekend,
                    dayOfWeek: dayOfWeek,
                    month: 10 // ç›´æ¥æ¨™è¨˜æœˆä»½
                });
            }

            // 11æœˆæœ‰30å¤©
            for (let day = 1; day <= 30; day++) {
                const date = new Date(year, 10, day); // 10ä»£è¡¨11æœˆ (0-based)
                const dayOfWeek = date.getDay();
                const dateStr = date.toISOString().split('T')[0];

                // é€±åå°æ‡‰
                const weekdays = ['é€±æ—¥', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­'];
                const weekdayName = weekdays[dayOfWeek];

                // åˆ¤æ–·æ˜¯å¦ç‚ºé€±æœ«
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;

                allDates.push({
                    date: dateStr,
                    display: `${year}/11/${day.toString().padStart(2, '0')} (${weekdayName})`,
                    isWeekend: isWeekend,
                    dayOfWeek: dayOfWeek,
                    month: 11 // ç›´æ¥æ¨™è¨˜æœˆä»½
                });
            }

            return allDates;
        }

        // åˆå§‹åŒ–æ—¥æœŸé¸é …
        function initializeDateOptions() {
            const dateGrid = document.getElementById('date-grid');
            const allDates = generateOctoberAndNovemberDates();

            let currentMonth = null;

            allDates.forEach(dateInfo => {
                // æª¢æŸ¥æ˜¯å¦éœ€è¦åŠ å…¥æœˆä»½åˆ†éš”ç·š
                const dateMonth = dateInfo.month; // ç›´æ¥ä½¿ç”¨æ¨™è¨˜çš„æœˆä»½
                if (currentMonth !== dateMonth) {
                    currentMonth = dateMonth;
                    const monthSeparator = document.createElement('div');
                    monthSeparator.className = 'month-separator';
                    monthSeparator.innerHTML = `ğŸ“… ${dateMonth}æœˆ`;
                    dateGrid.appendChild(monthSeparator);
                }

                const dateOption = document.createElement('div');
                dateOption.className = `date-option ${dateInfo.isWeekend ? 'weekend' : ''}`;

                dateOption.innerHTML = `
                    <input type="checkbox" id="date-${dateInfo.date}" value="${dateInfo.date}">
                    <label for="date-${dateInfo.date}">
                        ${dateInfo.display}
                        ${dateInfo.isWeekend ? 'ğŸŸ ' : 'ğŸ“…'}
                    </label>
                `;

                dateOption.addEventListener('click', function (e) {
                    if (e.target.tagName !== 'INPUT') {
                        const checkbox = this.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;
                    }
                    this.classList.toggle('selected', this.querySelector('input[type="checkbox"]').checked);
                });

                dateGrid.appendChild(dateOption);
            });
        }

        // æäº¤å€‹äººè³‡æ–™
        function submitPerson() {
            const name = document.getElementById('person-name').value.trim();
            if (!name) {
                alert('è«‹è¼¸å…¥æ‚¨çš„å§“å');
                return;
            }

            // æª¢æŸ¥æ˜¯å¦å·²ç¶“å¡«å¯«éï¼ˆä½†é€™æ¬¡ä¸è‡ªå‹•è¦†è“‹ï¼Œè€Œæ˜¯æé†’ï¼‰
            const existingPersonIndex = filledPeople.findIndex(person => person.name === name);
            if (existingPersonIndex !== -1) {
                if (!confirm('é€™å€‹å§“åå·²ç¶“å­˜åœ¨ï¼Œæ˜¯å¦è¦æ›´æ–°è³‡æ–™ï¼Ÿ')) {
                    return;
                }
                // ç§»é™¤èˆŠè³‡æ–™
                filledPeople.splice(existingPersonIndex, 1);
            }

            const selectedDates = [];
            const checkboxes = document.querySelectorAll('#date-grid input[type="checkbox"]:checked');

            if (checkboxes.length === 0) {
                alert('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹æœ‰ç©ºçš„æ—¥æœŸ');
                return;
            }

            checkboxes.forEach(checkbox => {
                selectedDates.push(checkbox.value);
            });

            filledPeople.push({
                name: name,
                availableDates: selectedDates
            });

            saveDataToStorage(); // ä¿å­˜åˆ° localStorage
            updateFilledPeopleDisplay();
            clearMyInput();
            alert(`${name} çš„æœ‰ç©ºæ™‚é–“å·²è¨˜éŒ„ï¼`);

            // è‡ªå‹•é¡¯ç¤ºå…±åŒæ™‚é–“
            autoDisplayCommonDates();
        }

        // æ›´æ–°å·²å¡«å¯«äººå“¡é¡¯ç¤º
        function updateFilledPeopleDisplay() {
            const filledPeopleDiv = document.getElementById('filled-people');
            const countSpan = document.getElementById('people-count');

            countSpan.textContent = filledPeople.length;

            if (filledPeople.length === 0) {
                filledPeopleDiv.innerHTML = '<p style="color: #666; text-align: center;">å°šç„¡äººå¡«å¯«</p>';
                return;
            }

            let html = '';
            filledPeople.forEach((person, index) => {
                html += `
                    <div class="person-card">
                        <div class="person-name">${person.name}</div>
                        <div>æœ‰ç©ºæ—¥æœŸ: `;

                person.availableDates.sort().forEach(date => {
                    const dateObj = new Date(date);
                    const month = dateObj.getMonth() + 1;
                    const day = dateObj.getDate();
                    const weekday = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][dateObj.getDay()];
                    html += `<span class="date-tag">${month}/${day} (é€±${weekday})</span>`;
                });

                html += `</div>
                        <div style="margin-top: 10px;">
                            <button class="edit-btn" onclick="editPerson(${index})" style="margin-right: 5px;">âœï¸ ä¿®æ”¹</button>
                            <button class="clear-btn" onclick="removePerson(${index})">ğŸ—‘ï¸ ç§»é™¤</button>
                        </div>
                    </div>
                `;
            });

            filledPeopleDiv.innerHTML = html;
        }

        // ä¿®æ”¹äººå“¡è³‡æ–™
        function editPerson(index) {
            const person = filledPeople[index];

            // ç¢ºèªæ˜¯å¦è¦ä¿®æ”¹
            if (!confirm(`è¦ä¿®æ”¹ ${person.name} çš„è³‡æ–™å—ï¼Ÿ`)) {
                return;
            }

            // å°‡è³‡æ–™è¼‰å…¥åˆ°è¡¨å–®ä¸­
            document.getElementById('person-name').value = person.name;

            // æ¸…é™¤æ‰€æœ‰é¸æ“‡
            clearMyInput();

            // é‡æ–°è¨­å®šå§“å
            document.getElementById('person-name').value = person.name;

            // å‹¾é¸è©²äººå“¡åŸæœ¬é¸æ“‡çš„æ—¥æœŸ
            person.availableDates.forEach(date => {
                const checkbox = document.getElementById(`date-${date}`);
                if (checkbox) {
                    checkbox.checked = true;
                    checkbox.closest('.date-option').classList.add('selected');
                }
            });

            // å…ˆç§»é™¤åŸæœ¬çš„è³‡æ–™
            filledPeople.splice(index, 1);
            saveDataToStorage();
            updateFilledPeopleDisplay();
            autoDisplayCommonDates();

            // æ»¾å‹•åˆ°å¡«å¯«å€åŸŸ
            document.querySelector('.input-section').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });

            // æç¤ºä½¿ç”¨è€…
            alert(`${person.name} çš„è³‡æ–™å·²è¼‰å…¥åˆ°ç·¨è¼¯å€åŸŸï¼Œè«‹ä¿®æ”¹å¾Œé‡æ–°æäº¤ï¼`);
        }

        // ç§»é™¤æŒ‡å®šäººå“¡
        function removePerson(index) {
            const person = filledPeople[index];
            if (confirm(`ç¢ºå®šè¦ç§»é™¤ ${person.name} çš„è³‡æ–™å—ï¼Ÿ`)) {
                filledPeople.splice(index, 1);
                saveDataToStorage(); // ä¿å­˜åˆ° localStorage
                updateFilledPeopleDisplay();

                // è‡ªå‹•æ›´æ–°å…±åŒæ™‚é–“é¡¯ç¤º
                autoDisplayCommonDates();
            }
        }

        // æ¸…é™¤æˆ‘çš„è¼¸å…¥
        function clearMyInput() {
            document.getElementById('person-name').value = '';
            const checkboxes = document.querySelectorAll('#date-grid input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.closest('.date-option').classList.remove('selected');
            });
        }

        // æ¸…é™¤å…¨éƒ¨è³‡æ–™
        function clearAll() {
            alert('å±çœ¼');
            // if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰äººçš„è³‡æ–™å—ï¼Ÿ')) {
            //     filledPeople = [];
            //     saveDataToStorage(); // æ¸…é™¤ localStorage
            //     updateFilledPeopleDisplay();
            //     clearMyInput();
            //     document.getElementById('result').innerHTML = '';
            // }
        }

        // è‡ªå‹•é¡¯ç¤ºå…±åŒæ™‚é–“ï¼ˆä¸éœ€è¦æ‰‹å‹•é»æ“ŠæŒ‰éˆ•ï¼‰
        function autoDisplayCommonDates() {
            if (filledPeople.length === 0) {
                document.getElementById('result').innerHTML = '';
                return;
            }

            if (filledPeople.length === 1) {
                // åªæœ‰ä¸€å€‹äººæ™‚é¡¯ç¤ºæç¤º
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `
                    <div class="status">
                        <h3>ğŸ“‹ ç›®å‰ç‹€æ³</h3>
                        <p>å·²æœ‰ <strong>1</strong> äººå¡«å¯«ï¼Œç­‰å¾…æ›´å¤šäººåŠ å…¥æ¯”è¼ƒå…±åŒæ™‚é–“...</p>
                    </div>
                `;
                return;
            }

            // æ‰¾å‡ºå…±åŒæ—¥æœŸ
            let commonDates = new Set(filledPeople[0].availableDates);

            for (let i = 1; i < filledPeople.length; i++) {
                const personDates = new Set(filledPeople[i].availableDates);
                commonDates = new Set([...commonDates].filter(date => personDates.has(date)));
            }

            displayResult(Array.from(commonDates).sort());
        }

        // æ¯”è¼ƒå…±åŒæœ‰ç©ºæ™‚é–“ï¼ˆä¿ç•™æ‰‹å‹•æŒ‰éˆ•åŠŸèƒ½ï¼‰
        function compareCommonDates() {
            autoDisplayCommonDates();
        }

        // é¡¯ç¤ºçµæœ
        function displayResult(commonDates) {
            const resultDiv = document.getElementById('result');

            let html = '<h2>ğŸ“Š å³æ™‚çµæœåˆ†æ</h2>';

            // é¡¯ç¤ºçµ±è¨ˆè³‡è¨Š
            html += `<div class="status">
                <p>ç›®å‰å·²æœ‰ <strong>${filledPeople.length}</strong> äººå¡«å¯«æœ‰ç©ºæ™‚é–“</p>
            </div>`;

            // é¡¯ç¤ºæ¯å€‹äººçš„æœ‰ç©ºæ—¥æœŸ
            html += '<h3>ğŸ‘¥ å„äººæœ‰ç©ºæ—¥æœŸ:</h3>';
            filledPeople.forEach(person => {
                html += `<p><strong>${person.name}:</strong> `;
                person.availableDates.sort().forEach(date => {
                    const isCommon = commonDates.includes(date);
                    const dateObj = new Date(date);
                    const month = dateObj.getMonth() + 1;
                    const day = dateObj.getDate();
                    const weekday = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][dateObj.getDay()];
                    html += `<span class="date-tag ${isCommon ? 'common-date' : ''}">${month}/${day} (é€±${weekday})</span>`;
                });
                html += '</p>';
            });

            // é¡¯ç¤ºå…±åŒæœ‰ç©ºæ—¥æœŸ
            html += '<h3>ğŸ¯ å…±åŒæœ‰ç©ºæ—¥æœŸ:</h3>';

            if (commonDates.length > 0) {
                html += '<div class="result">';
                html += `<p><strong>ğŸ‰ å¤ªå¥½äº†ï¼æ‰¾åˆ° ${commonDates.length} å€‹å¤§å®¶éƒ½æœ‰ç©ºçš„æ—¥æœŸ:</strong></p>`;
                commonDates.forEach(date => {
                    const dateObj = new Date(date);
                    const month = dateObj.getMonth() + 1;
                    const day = dateObj.getDate();
                    const weekday = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][dateObj.getDay()];
                    html += `<span class="date-tag common-date">${month}/${day} (é€±${weekday})</span>`;
                });
                html += '<p style="margin-top: 15px; color: #2e7d32; font-weight: bold;">âœ… å¯ä»¥é–‹å§‹è¦åŠƒè¡Œç¨‹å›‰ï¼</p>';
                html += '</div>';
            } else {
                html += '<div class="result no-result">';
                html += '<p><strong>ğŸ˜” ç›®å‰é‚„æ²’æœ‰æ‰¾åˆ°å¤§å®¶éƒ½æœ‰ç©ºçš„å…±åŒæ™‚é–“</strong></p>';
                html += '</div>';
            }

            // é¡¯ç¤ºå„æ—¥æœŸçµ±è¨ˆ
            if (filledPeople.length >= 2) {
                html += '<h3>ğŸ“ˆ å„æ—¥æœŸçµ±è¨ˆ:</h3>';
                const dateStats = {};

                filledPeople.forEach(person => {
                    person.availableDates.forEach(date => {
                        if (!dateStats[date]) {
                            dateStats[date] = [];
                        }
                        dateStats[date].push(person.name);
                    });
                });

                const sortedDates = Object.keys(dateStats).sort();
                html += '<div style="margin-top: 10px;">';

                sortedDates.forEach(date => {
                    const dateObj = new Date(date);
                    const month = dateObj.getMonth() + 1;
                    const day = dateObj.getDate();
                    const weekday = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][dateObj.getDay()];
                    const count = dateStats[date].length;
                    const percentage = Math.round((count / filledPeople.length) * 100);
                    const isCommon = count === filledPeople.length;

                    html += `
                        <div style="margin: 5px 0; padding: 8px; background: ${isCommon ? '#e8f5e8' : '#f5f5f5'}; border-radius: 5px; border-left: 4px solid ${isCommon ? '#4CAF50' : '#ddd'};">
                            <strong>${month}/${day} (é€±${weekday})</strong> - 
                            ${count}/${filledPeople.length} äººæœ‰ç©º (${percentage}%)
                            <br><small style="color: #666;">æœ‰ç©ºçš„äºº: ${dateStats[date].join(', ')}</small>
                        </div>
                    `;
                });

                html += '</div>';
            }

            resultDiv.innerHTML = html;
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = function () {
            loadDataFromStorage(); // è¼‰å…¥å„²å­˜çš„è³‡æ–™
            initializeDateOptions();
            updateFilledPeopleDisplay();

            // è¼‰å…¥æ™‚ä¹Ÿè‡ªå‹•é¡¯ç¤ºå…±åŒæ™‚é–“
            autoDisplayCommonDates();
        };
    </script>
</body>

</html>